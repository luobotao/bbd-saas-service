<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bbd.saas.dao.mysql.PostmanUserDao">
    <resultMap id="baseResultMap" type="com.bbd.saas.models.PostmanUser">
        <result column="id" property="id" jdbcType="INTEGER"/>
        <result column="staffid" property="staffid" jdbcType="VARCHAR"/>
        <result column="nickname" property="nickname" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="headicon" property="headicon" jdbcType="VARCHAR"/>
        <result column="companyname" property="companyname" jdbcType="VARCHAR"/>
        <result column="cardidno" property="cardidno" jdbcType="VARCHAR"/>
        <result column="substation" property="substation" jdbcType="VARCHAR"/>
        <result column="companyid" property="companyid" jdbcType="INTEGER"/>
        <result column="alipay_account" property="alipayAccount" jdbcType="VARCHAR"/>
        <result column="token" property="token" jdbcType="VARCHAR"/>
        <result column="bbttoken" property="bbttoken" jdbcType="VARCHAR"/>
        <result column="lat" property="lat" jdbcType="DOUBLE"/>
        <result column="lon" property="lon" jdbcType="DOUBLE"/>
        <result column="height" property="height" jdbcType="DOUBLE"/>
        <result column="addr" property="addr" jdbcType="VARCHAR"/>
        <result column="addrdes" property="addrdes" jdbcType="VARCHAR"/>
        <result column="shopurl" property="shopurl" jdbcType="VARCHAR"/>
        <result column="sta" property="sta" jdbcType="VARCHAR"/>
        <result column="spreadticket" property="spreadticket" jdbcType="VARCHAR"/>
        <result column="poststatus" property="poststatus" jdbcType="INTEGER"/>
        <result column="postrole" property="postrole" jdbcType="INTEGER"/>
        <result column="date_new" property="dateNew" jdbcType="TIMESTAMP"/>
        <result column="date_upd" property="dateUpd" jdbcType="TIMESTAMP"/>
        <result column="siteid" property="siteid" jdbcType="VARCHAR"/>
    </resultMap>
    
    <sql id="baseColumnList">
    	id,
    	staffid,
    	nickname,
        phone,
        headicon,
        companyname,
        cardidno,
        substation,
        companyid,
        alipay_account,
        token,
        bbttoken,
        lat,
        lon,
        height,
        addr,
        addrdes,
        shopurl,
        sta,
        spreadticket,
        poststatus,
        postrole,
        date_new,
        date_upd,
        siteid
    </sql>
    
    <insert id="insertUser" useGeneratedKeys="true" keyProperty="id" parameterType="com.bbd.saas.models.PostmanUser">
        INSERT INTO `postmanuser`(
        <include refid="baseColumnList"/>
        )
        VALUES (
        #{id,jdbcType=INTEGER},
        #{staffid,jdbcType=VARCHAR},
        #{nickname,jdbcType=VARCHAR},
        #{phone,jdbcType=VARCHAR},
        #{headicon,jdbcType=VARCHAR},
        #{companyname,jdbcType=VARCHAR},
        #{cardidno,jdbcType=VARCHAR},
        #{substation,jdbcType=VARCHAR},
        #{companyid,jdbcType=INTEGER},
        #{alipayAccount,jdbcType=INTEGER},
        #{token,jdbcType=INTEGER},
        #{bbttoken,jdbcType=INTEGER},
        #{lat,jdbcType=DOUBLE},
        #{lon,jdbcType=DOUBLE},
        #{height,jdbcType=DOUBLE},
        #{addr,jdbcType=VARCHAR},
        #{addrdes,jdbcType=VARCHAR},
        #{shopurl,jdbcType=VARCHAR},
        #{sta,jdbcType=VARCHAR},
        #{spreadticket,jdbcType=VARCHAR},
        #{poststatus,jdbcType=INTEGER},
        #{postrole,jdbcType=INTEGER},  
        #{dateNew,jdbcType=TIMESTAMP},
        #{dateUpd,jdbcType=TIMESTAMP},
        #{siteid,jdbcType=VARCHAR}
        )
    </insert>
    
	<select id="selectPostmanUserByPhone" resultMap="baseResultMap">
        SELECT
        <include refid="baseColumnList"/>
        FROM `postmanuser` where phone = #{phone}
        <if test="id != null and id != 0">
            and id != #{id}
        </if>
    </select>
    
    <update id="updateByPhone" parameterType="com.bbd.saas.models.PostmanUser">
        UPDATE `postmanuser`
        	<set>
	        	<if test="staffid != null">
	        	staffid = #{staffid,jdbcType=VARCHAR},
	        	</if>
	        	<if test="nickname != null">
	        	nickname = #{nickname,jdbcType=VARCHAR},
	        	</if>
                <if test="phone != null">
                    phone = #{staffid,jdbcType=VARCHAR},
                </if>
	        	<if test="headicon != null">
	        	headicon = #{headicon,jdbcType=VARCHAR},
	        	</if>
	        	<if test="companyname != null">
	        	companyname = #{companyname,jdbcType=VARCHAR},
	        	</if>
	        	<if test="cardidno != null">
	        	cardidno = #{cardidno,jdbcType=VARCHAR},
	        	</if>
	        	<if test="substation != null">
	        	substation = #{substation,jdbcType=VARCHAR},
	        	</if>
	        	<if test="companyid != null">
	        	companyid = #{companyid,jdbcType=INTEGER},
	        	</if>
	        	<if test="alipayAccount != null">
	        	alipay_account = #{alipayAccount,jdbcType=VARCHAR},
	        	</if>
	        	<if test="token != null">
	        	token = #{token,jdbcType=VARCHAR},
	        	</if>
	        	<if test="bbttoken != null">
	        	bbttoken = #{bbttoken,jdbcType=VARCHAR},
	        	</if>
	        	<if test="lat != null">
	        	lat = #{lat,jdbcType=DOUBLE},
	        	</if>
	        	<if test="lon != null">
	        	lon = #{lon,jdbcType=DOUBLE},
	        	</if>
	        	<if test="height != null">
	        	height = #{height,jdbcType=DOUBLE},
	        	</if>
	        	<if test="addr != null">
	        	addr = #{addr,jdbcType=VARCHAR},
	        	</if>
	        	<if test="addrdes != null">
	        	addrdes = #{addrdes,jdbcType=VARCHAR},
	        	</if>
	        	<if test="shopurl != null">
	        	shopurl = #{shopurl,jdbcType=VARCHAR},
	        	</if>
	        	<if test="sta != null">
	        	sta = #{sta,jdbcType=VARCHAR},
	        	</if>
	        	<if test="spreadticket != null">
	        	spreadticket= #{spreadticket,jdbcType=VARCHAR},
	        	</if>
	        	<if test="poststatus != null">
	        	poststatus = #{poststatus,jdbcType=INTEGER},
	        	</if>
	        	<if test="postrole != null">
	        	postrole = #{postrole,jdbcType=INTEGER},  
	        	</if>
	        	<if test="dateNew != null">
	        	date_new = #{dateNew,jdbcType=TIMESTAMP},
	        	</if>
	        	<if test="dateUpd != null">
	        	date_upd = #{dateUpd,jdbcType=TIMESTAMP},
	        	</if>
	        	<if test="siteid != null">
                    siteid = #{siteid,jdbcType=VARCHAR},
	        	</if>
        	</set>
        	WHERE phone = #{phone,jdbcType=INTEGER}
    </update>
    
    <delete id="deleteById">
        delete from postmanuser where id = #{id,jdbcType=INTEGER}
    </delete>
    
    <update id="updateById" >
        update postmanuser set sta = #{sta,jdbcType=INTEGER}  where id = #{id,jdbcType=INTEGER}
    </update>
    
    <update id="updatePostmanUserById" >
        update postmanuser set nickname = #{nickname,jdbcType=VARCHAR}  
        where id = #{id,jdbcType=INTEGER}
    </update>
    
    <select id="selectAll" resultMap="baseResultMap">
        SELECT
        <include refid="baseColumnList"/>
        FROM `postmanuser`
    </select>
    
    <select id="selectIdByPhone" resultType="int">
        SELECT id
        FROM `postmanuser` where <![CDATA[ phone = #{phone,jdbcType=VARCHAR}]]>
    </select>
    <select id="selectLatAndLngByCompanyId" resultType="java.util.HashMap">
        SELECT id, phone, nickname, lat, lon
        FROM `postmanuser`  WHERE companyid = #{companyId} and sta = 1
    </select>
    <select id="selectLatAndLngByIds" resultType="java.util.HashMap">
        SELECT nickname, lat, lon
        FROM `postmanuser`  WHERE id in
        <foreach item="item" index="index" collection="ids" open="(" separator="," close=")">
            #{item}
        </foreach>
        and sta = 1
    </select>

    <resultMap type="java.util.HashMap" id="statResultMap" >
        <result column="userscore" property="userscore" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="timescore" property="timescore" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="deliveryscore" property="deliveryscore" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="perscore" property="perscore" javaType="java.lang.Integer" jdbcType="INTEGER"/>
        <result column="totalscore" property="totalscore" javaType="java.lang.Integer" jdbcType="INTEGER"/>
    </resultMap>

    <select id="getIntegral" statementType="CALLABLE" parameterType="Map" resultMap="statResultMap">
        {call sp_postman_station_score(#{areaCode,mode=IN,jdbcType=VARCHAR},#{phone,mode=IN,jdbcType=VARCHAR})}
    </select>

    <update id="updateRoleByPhone" >
        update postmanuser set postrole = #{postrole}  where  phone = #{phone}
    </update>
</mapper>
